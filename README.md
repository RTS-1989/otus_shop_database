# otus_shop_database

Домащнее задание №1

Схема базы данных:

![no schema file :(](./db_course_hw1/shop_db_schema.jpg?raw=true)

Докумментация:

База данных содержит таблицы для интернет-магазина

Описание таблиц для бд интернет-магазина:
- category - содержит категории продуктов
- producer - содержит информацию о производителе товара
- provider - содержит информацию о продавце товара
- contacts - содержит информцию о контактах покупателя
- customer - содержит информацию о покупателе
- products - содержит данные о продуктах (описание, идентификатор производителя, категорию товара)
- price    - содержит информацию о цене на товар (цена на товар от одного производителя у разных продавцов может различаться)
- purchase - содержит информацию о покупке (содержит информцию)
- stock_goods - содержит информацию о запасах товара

Примеры бизнес-задач, которые решает база данных:

- Добавление информации о покупке товара у соответствующего поставщика/продавца
- Создание базы данных поставщиков
- Создание базы данных производителей
- Создание базы данных клиентов и контактов клиентов
- Хранение данных о ценах продуктов у различных поставщиков
- Создание номенклатуры товаров
- Хранение и использование информации о складских запасах товаров
- Аналитика данных по продажам товаров от определенных продавцов (средний чек, кто больше продал и т.д.)
- Аналитика по продажам товаров определенных производитилей
- Аналитика продаж в зависимости от размеров складских остатков

Рекомендации к репликации

Точно не знаю как, но предполагаю что:

1. Стоит использовать потоковую синхронную репликацию для гарантированной записи данных минимум на одну реплику.
2. Если интернет-магазин достаточно крупный и предполагается, что аудитория представлена на большой территории, то следует распределять данные по нескольким регионам для ускорения работы локально в определенном регионе.

Рекомендации по резервному копированию

Точно не знаю, но предполагаю что:

1. Можно использовать я bash-скрипт, который будет запускаться в crontab ночью и запускать с помощью встроенной утилиты pg_dump создание резервной копии определенной базы данных.
2. В скрипте можно описать удаление дампов базы данных, дата создания которых более чем определенное время, скажем 2 месяца.
3. В случае, если необходимо создавать резервную копию всего инстанса, можно использовать pg_dumpall, но в данном случае имеется только 1 база данных.

Домашнее задание №2

Индексы:

- idx_price_value - простой индекс. Ускоряет запросы для поиска по значению цены. Для поиска значений больше или меньше определенных значений не работает.
- idx_price_product_id_value - композитный индекс. Ускоряет запросы по идентификатору product_id и значению цены value в таблице price.
- idx_price_value_provider_id - композитный индекс. Ускоряет запросы по идентификатору provider_id и значению цены value в таблице price.
- idx_products_title - простой индекс. Ускоряет запросы по полю title таблицы products.
- idx_purchase_price_id - простой индекс. Ускоряет запросы по таблице purchase по полю price_id.
- idx_stock_goods_product_id_goods_balance - композитный индекс. Ускоряет поиск по таблице stock_goods по полям product_id и goods_balance. 
- idx_stock_goods_provider_id_goods_balance - композитный индекс. Ускоряет поиск по таблице stock_goods по поляем provider_id и goods_balance.

Ограничения:
- Таблица category имеет ограничение NOT NULL и UNIQUE по полю name, чтобы нельзя было вводить пустые значения и, чтобы не дублировать катеогрии для таблицы категорий. Также имеется PRIMARY KEY, который является элиасом для ограничений UNIQUE и NOT NULL.
- Таблица producer имеет ограничение NOT NULL и UNIQUE по полю name, чтобы нельзя было вводить пустые значения и, чтобы не дублировать производителей для таблицы производителей. Также имеется PRIMARY KEY, который является элиасом для ограничений UNIQUE и NOT NULL.
- Таблица provider имеет ограничение NOT NULL и UNIQUE по полю name, чтобы нельзя было вводить пустые значения и, чтобы не дублировать продавцов для таблицы продавцов. Также имеется PRIMARY KEY, который является элиасом для ограничений UNIQUE и NOT NULL.
- Таблица contacts имеет ограничение NOT NULL и UNIQUE по полю email, чтобы нельзя было вводить пустые значения и, чтобы email был уникальный для почты для таблицы с контактами. Также имеется PRIMARY KEY, который является элиасом для ограничений UNIQUE и NOT NULL.
- Таблица customer имеет ограничение NOT NULL по полю name, last_name, contact_id чтобы нельзя было вводить пустые значения для для имени, фамилии и идентификатор контакта таблицы потребителей. Также имеется PRIMARY KEY, который является элиасом для ограничений UNIQUE и NOT NULL. Также есть ограничения для FOREIGN KEY по полю contact_id на таблицу contacts, которая в случае удаления контакта удаляет пользователя.
- Таблица products имеет огранчиения NOT NULL для полей title, description, category_id, producer_id. Также имеется PRIMARY KEY, который является элиасом для ограничений UNIQUE и NOT NULL. Также есть ограничения для FOREIGN KEY по полю category_id на таблицу category, которая в случае удаления категории ставит значение поля category_id NULL. Также есть ограничение FOREIGN KEY для поля producer_id на таблицу producer. В случае удаления записи о производителе товара запись о продукте будет удалена.
- Таблица price имеет ограничения NOT NULL для полей value, product_id, provider_id. Также есть ограничение по значению для поля value. Значение поля должно быть больше нуля. Также есть ограничения для FOREIGN KEY по полю product_id на таблицу products, которая в случае удаления продукта удаляет цену. Кроме этого есть ограничения для FOREIGN KEY по полю provider_id на таблицу provider, которая в случае удаления записи о продавце удаляет запись о цене. Также имеется PRIMARY KEY для поля id, который является элиасом для ограничений UNIQUE и NOT NULL.
- Таблица purchase имеет ограничение NOT NULL для полей customer_id и price_id. Также есть ограничения FOREIGN KEY по полю customer_id на таблицу customer, которая в случае удаления пользователя удаляет запись о покупке. Также есть ограничение FOREIGN KEY по полю price_id на таблицу price, которая в случае удаления цены удаляет запись о покупке. Также имеется PRIMARY KEY по полю id, который является элиасом для ограничений UNIQUE и NOT NULL.
- Таблица имеет ограничение NOT NULL для полей goods_balance, product_id, provider_id. Также есть ограничение на значение поля goods_balance, которое должно быть больше либо равно 0, так как баланс товаров у продавца не может быть отрицптельным числом. Также есть ограничение FOREIGN KEY по полю product_id на таблицу products, которая в случае удаления продукта удаляет запись о количестве хранимого товара. Кроме этого есть ограничение FOREIGN KEY по полю provider_id на таблицу provider, которая в случае удаления записи о прродавце удаляет записи о запасах продавца. Еще имеется огранчиенте PRIMARY KEY по полю id, который является элиасом для ограничений UNIQUE и NOT NULL.
